# ğŸ“Š Registration & Group Code Flow - Visual Guide

## Registration Flow Overview

```
START REGISTRATION
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 1: Email & Name            â”‚
â”‚ [Your Name]        [Email]      â”‚
â”‚              â†’ NEXT              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 2: Password                â”‚
â”‚ [Password]  [Strength Bar: â–ˆ ]  â”‚
â”‚ [Confirm]   Requirements âœ“âœ—âœ“âœ—  â”‚
â”‚              â†’ NEXT              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 3: Profile Photo           â”‚
â”‚ [Upload 1:1 Photo] (Optional)   â”‚
â”‚              â†’ NEXT              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 4: Solo or Group?          â”‚
â”‚ [ğŸµ SOLO]      [ğŸ’œğŸ‘¥ GROUP]     â”‚
â”‚          (Click one)             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
    â”œâ”€ SOLO MODE â”€â”€â†’ REGISTER & LOGIN â”€â”€â†’ HOME PAGE âœ…
    â”‚
    â””â”€ GROUP MODE â”€â”€â†’ STEP 5 (Group Connection)
           â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ STEP 5: Group Connection         â”‚
    â”‚                                  â”‚
    â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
    â”‚ â”‚ âœ¨ CREATE GROUP             â”‚  â”‚
    â”‚ â”‚ [âœ¨ Generate Code]          â”‚  â”‚
    â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
    â”‚           OR                      â”‚
    â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
    â”‚ â”‚ ğŸ”“ JOIN GROUP               â”‚  â”‚
    â”‚ â”‚ [Enter Code Here]           â”‚  â”‚
    â”‚ â”‚ [ğŸ”“ Join Group]             â”‚  â”‚
    â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
    â”‚                                  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â†“
    (SEE NEXT SECTION)
```

---

## GROUP MODE - DETAILED FLOW

### Path A: Creating New Group

```
Step 5: Group Connection
        â†“
    BEFORE:
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ âœ¨ CREATE GROUP             â”‚
    â”‚ [âœ¨ Generate Code]          â”‚
    â”‚          â†“                  â”‚
    â”‚ ğŸ”“ JOIN GROUP               â”‚
    â”‚ [Enter Code] [Join]         â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â†“
    USER CLICKS: [âœ¨ Generate Code]
        â†“
    BACKEND:
    1. Register user (no login)
    2. Create unique 16-char code
    3. Save to user.groupCode
        â†“
    AFTER:
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Your Unique Code:           â”‚
    â”‚                             â”‚
    â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
    â”‚ â”‚ A7F3C9E2B1D4F6A8      â”‚   â”‚
    â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
    â”‚                             â”‚
    â”‚ [ğŸ“‹ Copy Code]              â”‚
    â”‚                             â”‚
    â”‚ Share with your partner     â”‚
    â”‚                             â”‚
    â”‚ [âœ… Complete Registration]  â”‚
    â”‚ [â† Back]                    â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â†“
    USER CLICKS: [âœ… Complete Registration]
        â†“
    FRONTEND:
    1. Call login endpoint
    2. Get full user data
    3. Store in localStorage
    4. Redirect to home
        â†“
    HOME PAGE - LOGGED IN âœ…
```

### Path B: Joining Existing Group

```
Step 5: Group Connection
        â†“
    BEFORE:
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ âœ¨ CREATE GROUP             â”‚
    â”‚ [âœ¨ Generate Code]          â”‚
    â”‚          â†“                  â”‚
    â”‚ ğŸ”“ JOIN GROUP               â”‚
    â”‚ [Enter Code] [Join]         â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â†“
    USER ENTERS CODE: "A7F3C9E2B1D4F6A8"
        â†“
    USER CLICKS: [ğŸ”“ Join Group]
        â†“
    BACKEND:
    1. Register user (no login)
    2. Find partner with that code
    3. Link both users together
    4. Clear partner's code
        â†“
    AFTER:
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ âœ… Registration Complete!   â”‚
    â”‚                             â”‚
    â”‚ You're now part of a group. â”‚
    â”‚ Click below to finish.      â”‚
    â”‚                             â”‚
    â”‚ [âœ… Complete Registration]  â”‚
    â”‚ [â† Back]                    â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â†“
    USER CLICKS: [âœ… Complete Registration]
        â†“
    FRONTEND:
    1. Call login endpoint
    2. Get full user data
    3. Store in localStorage
    4. Redirect to home
        â†“
    HOME PAGE - LOGGED IN âœ…
```

---

## ğŸ”„ User Linking Process

### When Partner Creates Code

```
PARTNER (User A)
â”œâ”€ Email: samra@gmail.com
â”œâ”€ Password: MyPass123!@
â”œâ”€ isGroupMode: true
â”œâ”€ groupCode: "A7F3C9E2B1D4F6A8"  â† Generated
â”œâ”€ groupMemberId: null
â””â”€ Status: Registered, NOT logged in

[Shares code with friend]
         â†“
         â†“
NEW USER (User B)
â”œâ”€ Email: friend@gmail.com
â”œâ”€ Password: MyPass456!@
â”œâ”€ isGroupMode: true
â”œâ”€ groupCode: null
â”œâ”€ groupMemberId: null
â””â”€ Status: Registered, NOT logged in
         â†“
    ENTERS CODE: "A7F3C9E2B1D4F6A8"
         â†“
    BACKEND LINKS THEM:
    
PARTNER (User A) - UPDATED
â”œâ”€ groupMemberId: User B's ID  â† Linked!
â””â”€ groupCode: null  â† Cleared

NEW USER (User B) - UPDATED
â”œâ”€ groupMemberId: User A's ID  â† Linked!
â””â”€ groupCode: null
         â†“
    BOTH USERS CAN NOW:
    â”œâ”€ See each other's songs
    â”œâ”€ See each other's listening status
    â””â”€ Share music in real-time
```

---

## ğŸ—„ï¸ Database Schema

### User Document Structure

```javascript
{
  _id: ObjectId("507f1f77bcf86cd799439011"),
  
  // Basic Info
  name: "Samra Khan",
  email: "samra@gmail.com",
  avatar: "data:image/png;base64,...",
  
  // Authentication
  passwordHash: "$2a$10$...", â† Bcrypt hashed
  sessionId: "uuid-1234-5678",
  
  // Group Info
  isGroupMode: true,
  groupCode: "A7F3C9E2B1D4F6A8",     â† Only if creating
  groupMemberId: ObjectId("..."),     â† If joined/invited
  
  // Status
  isOnline: true,
  lastSeen: ISODate("2025-11-15T14:30:00Z"),
  currentlyListening: "Song Name - Artist",
  lastListenedSong: "Previous Song",
  
  // Timestamps
  createdAt: ISODate("2025-11-15T14:00:00Z"),
  updatedAt: ISODate("2025-11-15T14:30:00Z")
}
```

---

## ğŸ” Password Validation Requirements

```
PASSWORD INPUT: "MyPass123!@"

Requirements Checklist:
âœ… Min 8 chars          (11 chars)
âœ… Uppercase (A-Z)      (M, P)
âœ… Lowercase (a-z)      (y, a, s, s)
âœ… Number (0-9)         (123)
âœ… Special (!@#$%)      (!@)

Status: âœ… STRONG (5/5 requirements met)
```

---

## ğŸš¨ Error States

### Duplicate Email
```
Input: samra@gmail.com (already exists)
    â†“
Error: "Email already registered"
User stays on Step 1
```

### Invalid Code
```
Input: "INVALIDCODE123"
    â†“
Backend searches: User.findOne({ groupCode })
    â†“
Not found!
    â†“
Error: "Invalid group code"
User stays in join form
```

### Weak Password
```
Input: "pass" (too short, no numbers, etc)
    â†“
Requirements show:
âŒ Min 8 chars    
âŒ Uppercase
âŒ Lowercase
âœ… Already weak
âŒ Special char
    â†“
Status: VERY WEAK
Button disabled until fixed
```

---

## ğŸ“± Frontend State Management

### RegistrationFlow Component State

```javascript
formData: {
  // Basic Info
  name: "Samra",
  email: "samra@gmail.com",
  password: "MyPass123!@",
  confirmPassword: "MyPass123!@",
  
  // Photo
  avatar: "data:image/png;base64,...",
  avatarPreview: "same...",
  
  // Group Info
  isGroupMode: true,        // true = group, false = solo
  generatedCode: null,      // Set when code generated
  userId: null,             // Set when registered
  partnerCode: ""           // User input for joining
}

step: 5
error: ""
loading: false
passwordStrength: {
  isValid: true,
  score: 5,
  requirements: { ... }
}
```

---

## ğŸ”„ API Calls Sequence

### Create Group Flow

```
1. POST /api/users/register
   Input: { name, email, password, avatar, isGroupMode }
   Output: { _id, sessionId, ... }
   
2. POST /api/users/generate-group-code/:userId
   Input: userId (from step 1)
   Output: { groupCode: "A7F3C9E2B1D4F6A8" }
   
3. POST /api/users/login
   Input: { email, password }
   Output: { _id, sessionId, isGroupMode, groupCode, ... }
   
4. localStorage.setItem('purpleUser', userData)
   
5. window.location.href = '/'
```

### Join Group Flow

```
1. POST /api/users/register
   Input: { name, email, password, avatar, isGroupMode }
   Output: { _id, sessionId, ... }
   
2. POST /api/users/join-group/:userId
   Input: { groupCode: "A7F3C9E2B1D4F6A8" }
   Output: { _id, groupMemberId, partnerName, ... }
   
3. POST /api/users/login
   Input: { email, password }
   Output: { _id, groupMemberId, ... }
   
4. localStorage.setItem('purpleUser', userData)
   
5. window.location.href = '/'
```

---

**Updated:** November 15, 2025  
**Status:** âœ… All Fixes Applied
